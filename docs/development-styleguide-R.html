<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>INBO style guide for R code</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">INBO tutorials</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software installation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="installation-R-admin.html">R as admin</a>
    </li>
    <li>
      <a href="installation-R-user.html">R as user</a>
    </li>
    <li>
      <a href="installation-RStudio-admin.html">RStudio as admin</a>
    </li>
    <li>
      <a href="installation-RStudio-user.html">RStudio as user</a>
    </li>
    <li>
      <a href="installation-git-admin.html">git as admin</a>
    </li>
    <li>
      <a href="installation-rtools-admin.html">Rtools as admin</a>
    </li>
    <li>
      <a href="installation-latex-admin.html">LaTeX as admin</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software development
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="development-styleguide-repos.html">Repository style guide</a>
    </li>
    <li>
      <a href="development-styleguide-R.html">R style guide</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">INBO style guide for R code</h1>

</div>


<div id="scope" class="section level1">
<h1>Scope</h1>
<p>This style guide is a recommendation for all R code written for the Research Institute for Nature and Forest (INBO). It is likely to have consequences on the current style used by many R users at INBO. Therefore this style guide should be applied within reason.</p>
<ol style="list-style-type: decimal">
<li>Don’t apply the style guide to existing code.</li>
<li>R users are free to apply the style guide to new personal R code.</li>
<li>Using the style guide is highly recommended for new or revised R code intended to be distributed and used by other R users.</li>
<li>The style guide is mandatory for new or revised R packages distributed by INBO.</li>
</ol>
<p>Please note that the RStudio editor has some handy features that automatically highlights errors against the code style in a non intrusive way. <strong>RStudio hints</strong> in this document are the instructions to activate these diagnostics in RStudio.</p>
</div>
<div id="recommended-packages" class="section level1">
<h1>Recommended packages</h1>
<div id="data-import" class="section level2">
<h2>Data import</h2>
<ul>
<li><code>readr</code>: import text files</li>
<li><code>readxl</code>: import Excel files</li>
<li><code>googlesheets</code>: import Google Sheets</li>
<li><code>DBI</code>: connect to databases PostgreSQL, SQLite, MySQL, Oracle, …</li>
<li><code>RODBC</code>: connect to databases SQL Server, Access</li>
</ul>
</div>
<div id="data-manipulation-transformation" class="section level2">
<h2>Data manipulation &amp; transformation</h2>
<ul>
<li><code>dplyr</code>:
<ul>
<li>subsetting observations</li>
<li>subsetting variables</li>
<li>changing variables</li>
<li>aggregation</li>
<li>combining dataframes</li>
</ul></li>
<li><code>tidyr</code>:
<ul>
<li>changing a dataframe from wide to long format and vice versa</li>
<li>nesting and unnesting dataframes</li>
<li>splitting a single variable into multiple variables</li>
</ul></li>
</ul>
</div>
<div id="graphics" class="section level2">
<h2>Graphics</h2>
<ul>
<li><code>ggplot2</code>:all static graphics, charts and plots</li>
<li><code>INBOtheme</code>: INBO corporate identity for <code>ggplot2</code> graphics</li>
</ul>
</div>
<div id="quality-control" class="section level2">
<h2>Quality control</h2>
<ul>
<li><code>lintr</code>: checking coding style</li>
<li><code>testthat</code>: writing unit tests</li>
<li><code>covr</code>: check which part of the code is not covered by unit tests</li>
</ul>
</div>
</div>
<div id="syntax" class="section level1">
<h1>Syntax</h1>
<p><strong>RStudio hint</strong>: <em>Tools &gt; Global options &gt; Code &gt; Diagnotics</em>: Check everything</p>
<div id="general" class="section level2">
<h2>General</h2>
<ul>
<li>lines should not exceed 80 characters
<ul>
<li>split the command over multiple lines if the command is longer than 80 characters</li>
<li><strong>RStudio hint</strong>: <em>Tools &gt; Global options &gt; Code &gt; Display</em>: Check <em>Show margin</em> and set <em>Margin column</em> to 80</li>
</ul></li>
<li>object names should be meaningful</li>
<li>object names should not exceed 20 characters</li>
<li>object names should be lowercase</li>
<li>use <code>_</code> to separate words in object names
<ul>
<li>function names with a single dot are allowed</li>
</ul></li>
<li>use double quotes (<code>&quot;</code>) around characters and not single quotes (<code>'</code>)</li>
<li>don’t add commented code
<ul>
<li>use version control if you want to keep old versions of code</li>
</ul></li>
</ul>
<pre class="r"><code># Good
example_text &lt;- example_function(
  first_argument = &quot;Some text&quot;,
  second_argument = &quot;More text&quot;
)

# Bad
some.really.long.dot.separated.name &lt;- MyCoolFunction(FirstArgument = &#39;Some text&#39;, second.argument = &#39;More text&#39;)</code></pre>
</div>
<div id="whitespace" class="section level2">
<h2>Whitespace</h2>
<ul>
<li>don’t use tabs, use two spaces instead
<ul>
<li><strong>RStudio hint</strong>: <em>Tools &gt; Global options &gt; Code &gt; Editing</em>: Check <em>Insert spaces for tab</em> and set <em>Tab width</em> to 2</li>
</ul></li>
<li>no space before a comma, one space after a comma</li>
<li>one space before and after an infix operator (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>, <code>&amp;</code>, <code>|</code>, <code>%%</code>, <code>%/%</code>, <code>%*%</code>, <code>%in%</code>, …)</li>
<li>no spaces a the end of a line
<ul>
<li><strong>RStudio hint</strong>: <em>Tools &gt; Global options &gt; Code &gt; Saving</em>: Check <em>Strip trailing horizontal whitespace when saving</em></li>
</ul></li>
<li>end the script file with a single blank line
<ul>
<li><strong>RStudio hint</strong>: <em>Tools &gt; Global options &gt; Code &gt; Saving</em>: Check <em>Ensure that source files end with newline</em></li>
</ul></li>
</ul>
</div>
<div id="assignments" class="section level2">
<h2>Assignments</h2>
<ul>
<li>only create an object when you will use it later on</li>
<li>always use <code>&lt;-</code> for assignment</li>
<li>use <code>=</code> only for passing arguments in a function</li>
<li>at least one space before and at least one space after <code>&lt;-</code> and <code>=</code>
<ul>
<li>use multiple spaces if it improves readability</li>
</ul></li>
</ul>
<pre class="r"><code># Good
x &lt;- data.frame(z = 1:10)
summary(x)

# Bad
x=data.frame(z&lt;-1:10)

# Improved readability example
a   &lt;-   5
ab  &lt;-  10
abc &lt;-   7
d   &lt;- 245</code></pre>
</div>
<div id="brackets" class="section level2">
<h2>Brackets</h2>
<p>R uses three types of brackets: round <code>(...)</code>, square <code>[...]</code> and curly <code>{...}</code>.</p>
<ul>
<li>no spaces after opening a bracket</li>
<li>no spaces before closing a bracket</li>
<li>no spaces before opening a bracket except:
<ul>
<li>one space with control flow functions (<code>if</code>, <code>else</code>, <code>for</code>, <code>while</code>)</li>
</ul></li>
<li>no spaces after closing a bracket except:
<ul>
<li>one space with control flow functions (<code>if</code>, <code>else</code>, <code>for</code>, <code>while</code>)</li>
</ul></li>
<li><code>{</code> should not start on a newline and is always the end of a line</li>
<li>apply indentation when splitting long text inside brackets over multiple lines</li>
</ul>
<pre class="r"><code># Good
y &lt;- seq(0, 2)
if (max(y) &lt;= 10) {
  x &lt;- 1
} else {
  x &lt;- 2
}
sapply(
  y,
  function(x){
    return(x)
  }
)

# Bad
y &lt;- seq (0, 2   )
if(   max( y ) &lt;= 10    )        
{ x &lt;- 1 } else 
{ x &lt;- 2 }
sapply( y , function ( x ) { return(x)})</code></pre>
</div>
<div id="special-cases-and-exceptions" class="section level2">
<h2>Special cases and exceptions</h2>
<ul>
<li>selecting rows with square brackets <code>df[selection, ]</code>
<ul>
<li>this results in two conflicting rules
<ol style="list-style-type: decimal">
<li>a single space after a comma</li>
<li>no space before a bracket</li>
</ol></li>
<li>solution in case of a short command: add <code># nolint</code> after the command
<ul>
<li><code>df[selection, ] # nolint</code></li>
</ul></li>
<li>solution in case of a long command: split the command over several lines</li>
</ul></li>
</ul>
<pre class="r"><code># Good
relevant_subset &lt;- original_dataframe[
  original_dataframe$x &gt; some_value | original_dataframe$y &lt; some_other_value,
]
# Recommended dplyr alternative
relevant_subset &lt;- original_dataframe %&gt;%
  filter(x &gt; some_value | y &lt; some_other_value)

# Bad
relevant_subset &lt;- original_dataframe[original_dataframe$x &gt; some_value | original_dataframe$y &lt; some_other_value, ] # nolint</code></pre>
<ul>
<li>a really long text
<ul>
<li>text shorter than 80 characters but passed the 80 character limit due to the indentitation
<ul>
<li>solution: remove all indentation</li>
</ul></li>
<li>text longer than 80 characters
<ul>
<li>solution: add <code># nolint</code> at the end of the line</li>
</ul></li>
</ul></li>
<li>functions from other packages with names that don’t comply with this style guide
<ul>
<li>solution: add <code># nolint</code> at the end of the line</li>
</ul></li>
</ul>
<p><strong>Important notice</strong></p>
<p>Adding <code># nolint</code> at the end of a line excludes that line from the automatic checks for coding styles. Therefore use it only when you have no other options.</p>
</div>
<div id="validating-syntax" class="section level2">
<h2>Validating syntax</h2>
<p>The code below validate the syntax for an R file, an RMarkdown file or an R package.</p>
<p><strong>RStudio hint</strong>: Running this code within RStudio will open a <em>Markers</em> pane, indicating the filename, line number and the kind of syntax error that occurs. Double clicking on the error will open the file a the correct location, making it easy to rectify the problem.</p>
<p>Extra hint: start correcting for the last lines and work your way forward. This leave the line numbers of the errors intact until you solve them.</p>
<p>An example to clarify this. Suppose you have an error at line 10 and an error at line 100. Both errors are <code>lines should not be more than 80 characters</code>, so to solve them we have to split the lines over multiple lines.</p>
<p>Let say that we start with solving line 10 by splitting it over four lines. So the old line 10 becomes the new lines 10 to 13. Hence the old line 11 becomes the new line 14, and the old line 100 becomes the new line 103. When we now click on the marker for line 100, RStudio will go the current line 100 which is the old line 97. So you end up looking for an error at the wrong position.</p>
<p>Starting at the back solved this issue. In the same example we would start by solving line 100. Let’s assume we split this over two lines. So old line 100 because new line 100 and 101. Old line 101 becomes new line 102 but more importantly <strong>all line numbers before 100 are unchanged</strong>. So clicking on the marker for line 10 will take you the current line 10 which is the old line 10.</p>
<pre class="r"><code># validate a single file
lintr::lint(filename = &quot;file.R&quot;)
lintr::lint(filename = &quot;file.Rmd&quot;)

# validate a package
lintr::lint_package(path = &quot;.&quot;)</code></pre>
</div>
</div>
<div id="documentation" class="section level1">
<h1>Documentation</h1>
<div id="functions" class="section level2">
<h2>Functions</h2>
<ul>
<li>Add documentation above each function with <code>Roxygen</code> markup</li>
<li>Add inline comments where relevant</li>
</ul>
<div id="required-roxygen-tags" class="section level3">
<h3>Required Roxygen tags</h3>
<pre class="r"><code>#&#39; @title Title of the helpfile
#&#39; @description Description of the function in the helpfile
#&#39; @param define a parameter
#&#39; @export is the function exported by the package NAMESPACE
#&#39; @importFrom import a function from another package</code></pre>
</div>
<div id="optional-roxygen-tags" class="section level3">
<h3>Optional Roxygen tags</h3>
<pre class="r"><code>#&#39; @seealso link to other functions
#&#39; @section section title
#&#39; @alias other name for the topic
#&#39; @keywords a set of standardised keywords. See file.path(R.home(&quot;doc&quot;), &quot;KEYWORDS&quot;)
#&#39; @inheritParams inherit the definition of parameters from another function
#&#39; @examples a working example of the function
#&#39; @return a description of the output from the function</code></pre>
<p>See <a href="http://r-pkgs.had.co.nz/man.html#roxygen-comments" class="uri">http://r-pkgs.had.co.nz/man.html#roxygen-comments</a> for more information on Roxygen</p>
</div>
<div id="inbo-extra-requirements-for-package-description" class="section level3">
<h3>INBO extra requirements for package DESCRIPTION</h3>
<ul>
<li>license: MIT or GPL-3? In case of MIT a LICENSE file should be added and <code>License: MIT</code> to the DESCRIPTION. In case of GPL-3 it is sufficient to add <code>License: GPL-3</code> to the DESCRIPTION</li>
<li>list of authors in <code>Authors@R</code> format</li>
<li>INBO is listed as copyright holder</li>
<li>one or more roles are atributed to each person
<ul>
<li><code>cre</code>: package maintainer (only one person)</li>
<li><code>aut</code>: main author (at least one person)</li>
<li><code>ctb</code>: contributor (if relevant)</li>
<li><code>cph</code>: copyright holder (must be INBO)</li>
</ul></li>
</ul>
<p><a href="mailto:Authors@R">Authors@R</a>: c(person(“Els”, “Lommelen”, email = <a href="mailto:%22els.lommelen@inbo.be%22">&quot;els.lommelen@inbo.be&quot;</a>, role = c(“aut”, “cre”)), person(“Thierry”, “Onkelinx”, email = <a href="mailto:%22thierry.onkelinx@inbo.be%22">&quot;thierry.onkelinx@inbo.be&quot;</a>, role = “aut”), person(“Anja”, “Leyman”, email = <a href="mailto:%22anja.leyman@inbo.be%22">&quot;anja.leyman@inbo.be&quot;</a>, role = “ctb”), person(family = “Research Institute for Nature and Forest (INBO)”, email = <a href="mailto:%22info@inbo.be%22">&quot;info@inbo.be&quot;</a>, role = “cph”))</p>
</div>
</div>
<div id="how-tos" class="section level2">
<h2>How-to’s</h2>
<ul>
<li>Add one or more how-to’s to a package</li>
<li>Add them as RMarkdown vignettes</li>
</ul>
</div>
</div>
<div id="file-structure" class="section level1">
<h1>File structure</h1>
<div id="r-package" class="section level2">
<h2>R Package</h2>
<div id="functions-1" class="section level3">
<h3>Functions</h3>
<ul>
<li>all generic R functions should be distributed as an R package</li>
<li>use <code>devtools::create()</code> to start a new pacakge
<ul>
<li><strong>RStudio hint</strong>: <em>File &gt; New project &gt; New directory &gt; R Package</em>: Type the name in <em>Package name</em></li>
</ul></li>
<li>keep source files compact
<ul>
<li>create a separate file for each function, with the file name equal to the function name. This makes it easy to find the correct source file.</li>
<li>exception: very short auxilary functions with related functionality
<ul>
<li>related functions can be bundled into one R script</li>
<li>file name is either equal to the most important function or describes the related functionality</li>
</ul></li>
</ul></li>
<li>split large functions into several subfunctions</li>
</ul>
</div>
<div id="scripts" class="section level3">
<h3>Scripts</h3>
<ul>
<li>place scripts in the <code>inst</code> folder
<ul>
<li>the scripts will be available for the user after installing the package</li>
<li>the location of the scripts can be found with <code>system.file(&quot;script-name.R&quot;, package = &quot;yourpackage&quot;)</code></li>
<li>use a relevant folder structure when adding lots of files to <code>inst</code></li>
</ul></li>
</ul>
</div>
<div id="unit-tests" class="section level3">
<h3>Unit tests</h3>
<ul>
<li>use the <code>testthat</code> package for unit tests
<ul>
<li>use <code>devtools::use_testthat()</code> to setup the test infrastructure</li>
</ul></li>
<li>all unit tests are stored in <code>tests/testthat</code></li>
<li>all files should have either a <code>test_</code> or <code>helper_</code> prefix
<ul>
<li>files with <code>helper_</code> prefix contain auxiliary function for the tests but no tests</li>
</ul></li>
<li>the test files will be run in alphabetical order
<ul>
<li>setting the order of the files is easy by adding 3 letters to the prefix (eg. <code>test_aaa_</code>, <code>test_baa</code>, <code>test_zzz_</code>)</li>
<li>3 letters offers quite some flexibility to insert new files at the correct location without having to rename at lot of files. If the first file is <code>test_aaa_</code> and the second <code>test_baa</code>, they you can 675 files between the two.</li>
</ul></li>
<li>unit test files can be larger than source files</li>
<li>a unit test file can contain tests for several functions in case the functions are strongly related (e.g. subfunctions) and reuse test cases</li>
<li>each package should contain the unit for coding style as listed below
<ul>
<li>store this in a file <code>tests/testthat/test_zzz_coding_style.R</code></li>
<li>add this file to <code>.gitignore</code>
<ul>
<li>the coding style will be tested separatly when using continuous integration</li>
</ul></li>
</ul></li>
</ul>
<pre class="r"><code>if (requireNamespace(&quot;lintr&quot;, quietly = TRUE)) {
  context(&quot;lints&quot;)
  test_that(&quot;Package Style&quot;, {
    lintr::expect_lint_free()
  })
}</code></pre>
</div>
</div>
<div id="r-script" class="section level2">
<h2>R script</h2>
<ul>
<li>group a long set of commands with similar functionality into a dedicated function
<ul>
<li>e.g. <code>prepare_data()</code>, <code>do_analysis()</code>, <code>create_figure()</code>, …</li>
</ul></li>
<li>place the user defined functions in a separate file which you <code>source()</code> into the main script
<ul>
<li>it is better to use the same file structure as an R package</li>
<li>consider writing a simple package in case you have a lot of functions</li>
</ul></li>
</ul>
</div>
<div id="rmarkdown" class="section level2">
<h2>RMarkdown</h2>
<ul>
<li>each chunk has only one output (figure, table, summary, …)</li>
<li>don’t mix (heavy) calculations and output in the same chunk: this is more interesting for caching the results</li>
<li>give chunks a relevant name: this make debugging easier and file name of figures and Bookdown label will be based on the chunk name</li>
<li>avoid writing code that generates Markdown
<ul>
<li>use (parametrised) child documents instead</li>
</ul></li>
<li>use the bookdown version for long reports: this makes it easy to split a long report into several child documents</li>
</ul>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
