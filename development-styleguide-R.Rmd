---
title: "INBO style guide for R code"
maintainer: "Thierry Onkelinx"
output: html_document
---

# Scope

This style guide applies to all R code where INBO is copyright holder. It is mandatory for all new projects intended to be distributed and highly recommended for all other projects. It doesn't apply to existing projects, except when revising such project. Then the style guide applies to the revised parts of the code.

# Recommended packages

## Data import

`readr`
  ~ text files

`readexcel`
  ~ Excel files
  
`googlesheets`
  ~ googlesheets

`DBI`
  ~ connections to databases: PostgreSQL, SQLite, MySQL, Oracle, ...
  
`RODBC`
  ~ connections to SQL Server, Access

## Data manipulation and transformation

`dplyr`
  ~ subsetting observations
  ~ subsetting variables
  ~ changing variables
  ~ aggregation
  ~ combining dataframes

`tidyr`
  ~ changing a dataframe for wide to long format and vice versa
  ~ nesting and unnesting dataframes
  ~ splitting a single variable into multiple variables

## Graphics

`ggplot2`
  ~ all static graphics

`INBOtheme`
  ~ INBO corporate identity for `ggplot2` graphics

## Quality control

`lintr`
  ~ checking coding style

`testthat`
  ~ writing unit tests

`covr`
  ~ check which part of the code is not covered by unit tests

# Syntax

**RStudio hint**: _Tools_ -> _Global options_ -> _Code_ -> _Diagnotics_ -> Check everything

## General

- lines should not exceed 80 characters
    - split the command over multiple lines if the command is longer than 80 characters
    - **RStudio hint**: _Tools_ -> _Global options_ -> _Code_ -> _Display_ -> Check _Show margin_ and set _Margin column_ to 80
- object names should be meaningful
- object names should not exceed 20 characters
- object names should lowercase
- use `_` to separate words in object names
    - function names with a single dot are allowed
- use single quotes (`'`) around characters and not double quotes (`"`)
- don't add commented code
    - use version control is you want to keep old versions of code

```{r eval = FALSE}
# Good
example_text <- example_function(
  first_argument = 'Some text', 
  second_argument = 'More text'
)

# Wrong
some.really.long.dot.separated.name <- MyCoolFunction(FirstArgument = "Some text", second.argument = "More text")
```

## Whitespace

- don't use tabs, use two spaces instead
    - **RStudio hint**: _Tools_ -> _Global options_ -> _Code_ -> _Editing_ -> Check _Insert spaces for tab_ and set _Tab width_ to 2
- no space before a comma, one space after a comma
- one space before and after an infix operator (`+`, `-`, `*`, `/`, `^`, `&`, `|`, `%%`, `%/%`, `%*%`, `%in%`, ...)
- no spaces a the end of a line
    - **RStudio hint**: _Tools_ -> _Global options_ -> _Code_ -> _Saving_ -> Check _Strip trailing horizontal whitespace when saving_
- the script file end with a single blank line
    - **RStudio hint**: _Tools_ -> _Global options_ -> _Code_ -> _Saving_ -> Check _Ensure that source files end with newline_

## Assignments

- only create an object when you will use it later on
- always use `<-` for assignment
- use `=` only for passing arguments in a function
- one space before and one space after `<-` and `=`

```{r eval = FALSE}
# Good
x <- data.frame(z = 1:10)
summary(x)

# Wrong
x=data.frame(z<-1:10)
```

## Brackets

R uses three types of brackets: round `(`, `)`, square `[`, `]` and curly `{`, `}`.

- no spaces after opening a bracket
- no spaces before closing a bracket
- no spaces before opening a bracket except:
    - one space with control flow functions (`if`, `else`, `for`, `while`)
- no spaces after closing a bracket except:
    - one space with control flow functions (`if`, `else`, `for`, `while`)
- `{` should not start on a newline and is always the end of a line
- apply indentation when splitting long text inside brackets over multiple lines

```{r eval = FALSE}
# Good
y <- seq(0, 2)
if (max(y) <= 10) {
  x <- 1
} else {
  x <- 2
}
sapply(
  y, 
  function(x){
    return(x)
  }
)

# Wrong
y <- seq (0, 2   )
if(   max( y ) <= 10    )        
{ x <- 1 } else 
{ x <- 2 }
sapply( y , function ( x ) { return(x)})
```

## Special cases and exceptions

- selecting rows with square brackets `df[selection, ]`
    - this results in two conflicting rules
        1. a single space after a comma
        1. no space before a bracket
    - solution in case of a short command: add `# nolint` after the command
        - `df[selection, ] # nolint`
    - solution in case of a long command: split the command over several lines

```{r eval = FALSE}
# Good
relevant_subset <- original_dataframe[
  original_dataframe$x > some_value | original_dataframe$y < some_other_value, 
]
# Recommended dplyr alternative
relevant_subset <- original_dataframe %>%
  filter(x > some_value | y < some_other_value)

# Wrong
relevant_subset <- original_dataframe[original_dataframe$x > some_value | original_dataframe$y < some_other_value, ] # nolint
```

- a really long text
    - text shorter than 80 characters but passed the 80 character limit due to the indentitation
        - solution: remove all indentation
    - text longer than 80 characters
        - solution: add `# nolint` at the end of the line
- functions from other packages with names that don't comply with this style guide
    - solution: add `# nolint` at the end of the line

**Important notice**

Adding `# nolint` at the end of a line excludes that line from the automatic checks for coding styles. Therefore use it only when you have no other options.

# Documentation

## Functions

- Add documentation above each function with `Roxygen` markup
- Add inline comments where relevant

## How-to's

- Add one or more how-to's to a package
- Add them as RMarkdown vignettes
